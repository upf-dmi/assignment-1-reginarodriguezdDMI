---
title: "Hands On-1"
author: "Regina Rodriguez Durant (regina.rodriguezdurant01@estudiant.upf.edu)"
date: "Last update: `r format(Sys.time(), '%d %B, %Y')`"      
output:
  html_document:
    toc: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readr)
library(dplyr)
library(knitr)
library(kableExtra)
library(ggplot2)
library(visdat)
library(corrplot)
```


This practical focuses on data wrangling, exploratory data analysis, visualization, and critical comparison with published results using real biomedical data.

We will work with the publication  
[**Proteomic and Metabolomic Characterization of COVID-19 Patient Sera**](https://www.sciencedirect.com/science/article/pii/S0092867420306279)



# Exercise 1
Download and load Supplementary Table 1 (“Additional Demographical and Baseline Characteristics of COVID-19 Patients and Control Groups”) from the supplementary materials of the publication.
```{r load-data}
data <- read_csv("data/Table_S1. - Clinical_information.csv", na = c("/", ""))
names(data)
```

#Names of the variables
```{r variables}
data <- data %>%
rename(
Group = `Group d`,
Sex   = `Sex g`,
Age   = `Age (year)`,
BMI   = `BMI h`
) %>%
mutate(
Group = as.factor(Group),
Sex   = as.factor(Sex)
)
```

```{r data}
str(data)
summary(data)
```

## Exercise 1.1

#Reproduce Table 1 from the manuscript using the supplementary data. Match the reported summary statistics as closely as possible.

#Briefly discuss any discrepancies between your results and the published table, and provide possible explanations.

```{r table1}
data <- data %>%
  mutate(
    Group = as.factor(Group),
    Sex   = as.factor(Sex)
  )

table1 <- data %>%
  group_by(Group) %>%
  summarise(
    Age_mean = round(mean(Age, na.rm = TRUE), 1),
    Age_sd   = round(sd(Age, na.rm = TRUE), 1),
    BMI_mean = round(mean(BMI, na.rm = TRUE), 1),
    BMI_sd   = round(sd(BMI, na.rm = TRUE), 1),
    Female_pct = round(mean(Sex == "Female", na.rm = TRUE) * 100, 1),
    N = n(),
    .groups = "drop"
  )

kable(
  table1,
  caption = "Reproduced Table 1: Summary statistics by group"
) %>%
  kable_styling(full_width = FALSE)
```

## Exercise 1.2

#Perform an exploratory data analysis (EDA) of the dataset. At a minimum, include:

#- Descriptive statistics for key variables\
#- Appropriate visualizations (e.g. distributions, group comparisons)\
#- A brief written summary of notable patterns, anomalies, or data quality issues

```{r basic-summary}
summary(data)
```

```{r missing}
vis_miss(data)
```

```{r age-dist}
ggplot(data, aes(x = Age)) +
  geom_histogram(bins = 20, fill = "steelblue", alpha = 0.7, na.rm = TRUE) +
  theme_minimal()
```


```{r age-group}
ggplot(data, aes(x = Group, y = Age)) +
  geom_boxplot() +
  theme_minimal()
```

# Exercise 2

## Exercise 2.1

Reproduce Supplementary Figure 1 using the data without modifying or removing any observations. Use the same variables and groupings as in the original figure.

```{r fig1}
ggplot(data, aes(x = Group, y = Age, fill = Group)) +
  geom_boxplot() +
  theme_minimal()
```

## Exercise 2.2

Identify and handle outliers using an appropriate and well-justified method (e.g. removal, transformation, or robust statistics).

Reproduce Supplementary Figure 1 after outlier handling and discuss how and why the results change.

```{r outliers}
data_no_out <- data %>%
  filter(Age < quantile(Age, 0.99, na.rm = TRUE))

ggplot(data_no_out, aes(x = Group, y = Age, fill = Group)) +
  geom_boxplot() +
  theme_minimal()
```

# Exercise 3

Create a heatmap of the biomarker data. Include group and gender as annotation variables.

```{r heatmap}
num_vars <- data %>% select(where(is.numeric))
corrplot(cor(num_vars, use = "complete.obs"), method = "color")
```

# Conclusion

Write a concise conclusion (1 paragraphs) summarizing the main differences observed across the three patient groups based on the twelve clinical parameters. Support your statements with evidence from your analyses.

# session info {.unnumbered}

```{r, results='asis',  echo=FALSE, message=FALSE }
sessionInfo()
```